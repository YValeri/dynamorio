<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PADLOC: api/samples/padloc/analyse.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PADLOC
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0188a3e6da905bc60aceb35bf790b8c9.html">api</a></li><li class="navelem"><a class="el" href="dir_e789fae5d8d5929b9d3e936f37779460.html">samples</a></li><li class="navelem"><a class="el" href="dir_87b899a77f2d71d2d94118ce958d6209.html">padloc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">analyse.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Library Manipulation API Sample, part of the Interflop project. <a class="el" href="analyse_8cpp.html" title="Library Manipulation API Sample, part of the Interflop project. analyse.cpp. ">analyse.cpp</a>.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a97b02fe35e69195bd4267cd04a807203"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a97b02fe35e69195bd4267cd04a807203">get_need_sse_inverse</a> ()</td></tr>
<tr class="memdesc:a97b02fe35e69195bd4267cd04a807203"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the NEED_SSE_INVERSE boolean.  <a href="#a97b02fe35e69195bd4267cd04a807203">More...</a><br /></td></tr>
<tr class="separator:a97b02fe35e69195bd4267cd04a807203"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa741bc82ad843d24bb310e28b3929dc4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#aa741bc82ad843d24bb310e28b3929dc4">set_need_sse_inverse</a> (bool new_value)</td></tr>
<tr class="memdesc:aa741bc82ad843d24bb310e28b3929dc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setter for the NEED_SSE_INVERSE boolean.  <a href="#aa741bc82ad843d24bb310e28b3929dc4">More...</a><br /></td></tr>
<tr class="separator:aa741bc82ad843d24bb310e28b3929dc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e95a4ec94b5878d3cbaf3799a7350f6"><td class="memItemLeft" align="right" valign="top">std::vector&lt; reg_id_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a3e95a4ec94b5878d3cbaf3799a7350f6">get_gpr_reg</a> ()</td></tr>
<tr class="memdesc:a3e95a4ec94b5878d3cbaf3799a7350f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the gpr_reg vector.  <a href="#a3e95a4ec94b5878d3cbaf3799a7350f6">More...</a><br /></td></tr>
<tr class="separator:a3e95a4ec94b5878d3cbaf3799a7350f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77a6a4d7dc2592551a3f340c828032cd"><td class="memItemLeft" align="right" valign="top">std::vector&lt; reg_id_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a77a6a4d7dc2592551a3f340c828032cd">get_float_reg</a> ()</td></tr>
<tr class="memdesc:a77a6a4d7dc2592551a3f340c828032cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Getter for the float_reg vector.  <a href="#a77a6a4d7dc2592551a3f340c828032cd">More...</a><br /></td></tr>
<tr class="separator:a77a6a4d7dc2592551a3f340c828032cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6296b7921d34f32e165011648e4c3286"><td class="memItemLeft" align="right" valign="top">std::vector&lt; reg_id_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a6296b7921d34f32e165011648e4c3286">get_all_registers</a> ()</td></tr>
<tr class="memdesc:a6296b7921d34f32e165011648e4c3286"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gather the gpr_reg and float_reg vectors into a single one, containing all registers used by the backend.  <a href="#a6296b7921d34f32e165011648e4c3286">More...</a><br /></td></tr>
<tr class="separator:a6296b7921d34f32e165011648e4c3286"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe0b282ea7a52928a97bfe82cbad2755"><td class="memItemLeft" align="right" valign="top"><a id="abe0b282ea7a52928a97bfe82cbad2755"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#abe0b282ea7a52928a97bfe82cbad2755">print_register_vectors</a> ()</td></tr>
<tr class="memdesc:abe0b282ea7a52928a97bfe82cbad2755"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the content of the gpr_reg and float_reg register, using print_vect for each. <br /></td></tr>
<tr class="separator:abe0b282ea7a52928a97bfe82cbad2755"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7621331aae952985b325477a951ff31f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a7621331aae952985b325477a951ff31f">enum_symbols_registers</a> (const char *name, size_t modoffs, void *data)</td></tr>
<tr class="memdesc:a7621331aae952985b325477a951ff31f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function that check if a symbol is one we're interested in.  <a href="#a7621331aae952985b325477a951ff31f">More...</a><br /></td></tr>
<tr class="separator:a7621331aae952985b325477a951ff31f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdb77d50d3a59aa7e77e87154045d00c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#acdb77d50d3a59aa7e77e87154045d00c">enum_symbols_sse</a> (const char *name, size_t modoffs, void *data)</td></tr>
<tr class="memdesc:acdb77d50d3a59aa7e77e87154045d00c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function that check whether or not the symbol is test_sse_src_order and instrument it if so.  <a href="#acdb77d50d3a59aa7e77e87154045d00c">More...</a><br /></td></tr>
<tr class="separator:acdb77d50d3a59aa7e77e87154045d00c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac655a3b78bef98a16c5becc4b2859be7"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#ac655a3b78bef98a16c5becc4b2859be7">analyse_argument_parser</a> (std::string arg, int *i, int argc, const char *argv[])</td></tr>
<tr class="memdesc:ac655a3b78bef98a16c5becc4b2859be7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parser for the command line.  <a href="#ac655a3b78bef98a16c5becc4b2859be7">More...</a><br /></td></tr>
<tr class="separator:ac655a3b78bef98a16c5becc4b2859be7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a903b1fa45cc4cb3e7957f42d2c813df1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a903b1fa45cc4cb3e7957f42d2c813df1">analyse_mode_manager</a> ()</td></tr>
<tr class="memdesc:a903b1fa45cc4cb3e7957f42d2c813df1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Analyse the backend if needed, and update the NEED_SSE_INVERSE boolean accordingly.  <a href="#a903b1fa45cc4cb3e7957f42d2c813df1">More...</a><br /></td></tr>
<tr class="separator:a903b1fa45cc4cb3e7957f42d2c813df1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cc8f48794e9cf37d3a5ec3fdcb82b29"><td class="memItemLeft" align="right" valign="top"><a id="a6cc8f48794e9cf37d3a5ec3fdcb82b29"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyse_8cpp.html#a6cc8f48794e9cf37d3a5ec3fdcb82b29">test_sse_src_order</a> ()</td></tr>
<tr class="memdesc:a6cc8f48794e9cf37d3a5ec3fdcb82b29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function used to check if the implicit operands problem was corrected or not. We assume the syntax used is ATT, since DynamoRIO can't compile if the one used by the compiler is intel's. <br /></td></tr>
<tr class="separator:a6cc8f48794e9cf37d3a5ec3fdcb82b29"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Library Manipulation API Sample, part of the Interflop project. <a class="el" href="analyse_8cpp.html" title="Library Manipulation API Sample, part of the Interflop project. analyse.cpp. ">analyse.cpp</a>. </p>
<p>This file analyses the current backend used in order to determine the different registers used by it. The goal is to know what needs to be saved by the frontend, so that the backend functions don't modify any register used by the application in an unpredictable way. The registers checked for GPRs and Floating points/SIMD registers.</p>
<p>Also, this file is used to check whether or not the problem regarding implicit operands and their order by DynamoRIO is solved or not.</p>
<dl class="section author"><dt>Author</dt><dd>Brasseur Dylan, Teaudors Mickaël, Valeri Yoann </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2019 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>Interflop </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ac655a3b78bef98a16c5becc4b2859be7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac655a3b78bef98a16c5becc4b2859be7">&#9670;&nbsp;</a></span>analyse_argument_parser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool analyse_argument_parser </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parser for the command line. </p>
<p>The options are :</p><ul>
<li>"analyse and abort", to analyse the backend, write the registers to a given file and abort</li>
<li>"analyse from file", to read an input file and parse it to populate the vectors</li>
<li>"analyse and run", to analyse the backend and run the program normaly. Default option.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>The current argument as string </td></tr>
    <tr><td class="paramname">i</td><td>The index of the current argument, given as pointer to be modified if necessary when checking for an option with special parameters </td></tr>
    <tr><td class="paramname">argc</td><td>The length of the command line </td></tr>
    <tr><td class="paramname">argv</td><td>The list of arguments in the command line </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the execution of the program must be stopped, else false </dd></dl>

</div>
</div>
<a id="a903b1fa45cc4cb3e7957f42d2c813df1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a903b1fa45cc4cb3e7957f42d2c813df1">&#9670;&nbsp;</a></span>analyse_mode_manager()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void analyse_mode_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Analyse the backend if needed, and update the NEED_SSE_INVERSE boolean accordingly. </p>
<p>Call drsym_enumerate_symbols to analyse the backend if needed, updating the vectors of registers. Also call drsym_enumerate_symbols with the SSE analyser, in order to update NEED_SSE_INVERSE. </p>

</div>
</div>
<a id="a7621331aae952985b325477a951ff31f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7621331aae952985b325477a951ff31f">&#9670;&nbsp;</a></span>enum_symbols_registers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool enum_symbols_registers </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>modoffs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function that check if a symbol is one we're interested in. </p>
<p>Callback function that will compare the given name of the symbol to one we want to check. If it is, we will start checking all the instructions in it, in order to populate the vectors.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The name of the symbol </td></tr>
    <tr><td class="paramname">modoffs</td><td>The offset of the sybol from the start of the library </td></tr>
    <tr><td class="paramname">data</td><td>Eventual data passed from the function that does the callback </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if we want to continue going through the symbols </dd></dl>

</div>
</div>
<a id="acdb77d50d3a59aa7e77e87154045d00c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdb77d50d3a59aa7e77e87154045d00c">&#9670;&nbsp;</a></span>enum_symbols_sse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool enum_symbols_sse </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>modoffs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function that check whether or not the symbol is test_sse_src_order and instrument it if so. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The name of the symbol </td></tr>
    <tr><td class="paramname">modoffs</td><td>The offset of the sybol from the start of the library </td></tr>
    <tr><td class="paramname">data</td><td>Eventual data passed from the function that does the callback </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if we want to continue going through the symbols </dd></dl>

</div>
</div>
<a id="a6296b7921d34f32e165011648e4c3286"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6296b7921d34f32e165011648e4c3286">&#9670;&nbsp;</a></span>get_all_registers()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;reg_id_t&gt; get_all_registers </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gather the gpr_reg and float_reg vectors into a single one, containing all registers used by the backend. </p>
<dl class="section return"><dt>Returns</dt><dd>The combination of both vectors </dd></dl>

</div>
</div>
<a id="a77a6a4d7dc2592551a3f340c828032cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77a6a4d7dc2592551a3f340c828032cd">&#9670;&nbsp;</a></span>get_float_reg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;reg_id_t&gt; get_float_reg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the float_reg vector. </p>
<dl class="section return"><dt>Returns</dt><dd>float_reg </dd></dl>

</div>
</div>
<a id="a3e95a4ec94b5878d3cbaf3799a7350f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e95a4ec94b5878d3cbaf3799a7350f6">&#9670;&nbsp;</a></span>get_gpr_reg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;reg_id_t&gt; get_gpr_reg </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the gpr_reg vector. </p>
<dl class="section return"><dt>Returns</dt><dd>gpr_reg </dd></dl>

</div>
</div>
<a id="a97b02fe35e69195bd4267cd04a807203"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97b02fe35e69195bd4267cd04a807203">&#9670;&nbsp;</a></span>get_need_sse_inverse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool get_need_sse_inverse </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Getter for the NEED_SSE_INVERSE boolean. </p>
<dl class="section return"><dt>Returns</dt><dd>NEED_SSE_INVERSE </dd></dl>

</div>
</div>
<a id="aa741bc82ad843d24bb310e28b3929dc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa741bc82ad843d24bb310e28b3929dc4">&#9670;&nbsp;</a></span>set_need_sse_inverse()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_need_sse_inverse </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>new_value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setter for the NEED_SSE_INVERSE boolean. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_value</td><td>The new value for NEED_SSE_INVERSE </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
